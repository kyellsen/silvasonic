# silvasonic-database

> **Tier:** 1 (Infrastructure) · **Engine:** TimescaleDB / PostgreSQL · **Instances:** Single

The Database is the central persistent store for the Silvasonic system, running TimescaleDB on PostgreSQL.

---

## Schema Management (Dev-Phase)

| Rule      | Detail                                                                                                                |
| :-------- | :-------------------------------------------------------------------------------------------------------------------- |
| **Edit**  | Always modify [`01-init-schema.sql`](init/01-init-schema.sql) directly.                                               |
| **Apply** | Tear down the database container and recreate — no incremental migrations during dev.                                 |
| **Sync**  | Every change to the SQL DDL **must** be mirrored in the SQLAlchemy models (`packages/core/…/models/`) and vice-versa. |

---

## Type Conventions

| Category        | Type                                         |
| :-------------- | :------------------------------------------- |
| Identifiers     | `BIGINT GENERATED BY DEFAULT AS IDENTITY`    |
| Timestamps      | `TIMESTAMPTZ` (= `TIMESTAMP WITH TIME ZONE`) |
| Strings         | `TEXT` (never `VARCHAR`)                     |
| Structured data | `JSONB`                                      |

---

## Hypertable Constraints (TimescaleDB)

- `detections` and `weather` are **hypertables** partitioned by `time`.
- TimescaleDB does **not** support Foreign Keys **referencing** a hypertable.
  → `recordings` must remain a **standard table** so that `detections` and `uploads` can reference it via FK.
- The partition key (`time`) **must** be part of the composite primary key on every hypertable.

---

## References

- [Database Schema](init/01-init-schema.sql) — DDL source of truth
- [SQLAlchemy Models](../../packages/core/src/silvasonic_core/models/) — ORM mirror
