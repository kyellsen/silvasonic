# Database Service

> TimescaleDB/PostgreSQL – Tier 1, single instance.

## Schema Management (Dev-Phase)

| Rule      | Detail                                                                                                                |
| :-------- | :-------------------------------------------------------------------------------------------------------------------- |
| **Edit**  | Always modify [`01-init-schema.sql`](../../services/database/init/01-init-schema.sql) directly.                       |
| **Apply** | Tear down the database container and recreate — no incremental migrations during dev.                                 |
| **Sync**  | Every change to the SQL DDL **must** be mirrored in the SQLAlchemy models (`packages/core/…/models/`) and vice-versa. |

## Type Conventions

| Category        | Type                                         |
| :-------------- | :------------------------------------------- |
| Identifiers     | `BIGINT GENERATED BY DEFAULT AS IDENTITY`    |
| Timestamps      | `TIMESTAMPTZ` (= `TIMESTAMP WITH TIME ZONE`) |
| Strings         | `TEXT` (never `VARCHAR`)                     |
| Structured data | `JSONB`                                      |

## Hypertable Constraints (TimescaleDB)

- `detections` and `weather` are **hypertables** partitioned by `time`.
- TimescaleDB does **not** support Foreign Keys **referencing** a hypertable.
  → `recordings` must remain a **standard table** so that `detections` and `uploads` can reference it via FK.
- The partition key (`time`) **must** be part of the composite primary key on every hypertable.
